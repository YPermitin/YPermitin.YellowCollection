# Просмотр и анализ журнала регистрации

Отчет на базе системы компоновки данных (СКД) для просмотра записей журнала регистрации. В отчете можно использовать возможности СКД для вывода отчета в различных вариантах (список, таблица, диаграмма). Поддерживаются все возможности журнала регистрации (фильтры, получаемые колонки, максимальное количество записей).

Материалы по другим темам Вы можете найти на сайте [ypermitin.github.io](https://ypermitin.github.io/), а новости по проектам или новым материалам в [Telegram-канале](https://t.me/TinyDevVault).

## Состав

* [media](media) - медиафайлы для документации данной разработки.
* [src](src) - файлы исходного кода.

## Назначение и возможности

Журнал регистрации платформы 1С:Предприятие содержит записи о действиях пользователей в информационных базах. 

Работать с журналом регистрации можно либо с помощью встроенный в платформу средства, либо программно. Выше представлен скриншот встроенной в платформу обработки "Журнал регистрации", которая позволяет просматривать журнал в виде списка. Несмотря на возможность установки отборов на выводимые в список события, просмотривать журнал в таком виде зачастую не очень удобно. Куда удобнее было бы делать это с группировками, собственными полями или даже в виде диаграммы.

![1. Пример работы с отчетом](./media/1.%20%D0%9F%D1%80%D0%B8%D0%BC%D0%B5%D1%80%20%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%8B%20%D1%81%20%D0%BE%D1%82%D1%87%D0%B5%D1%82%D0%BE%D0%BC.gif)

Как раз для таких целей и был создан представленный отчет. Используя его можно просматривать журнал регистрации в любом виде. Ограничения находятся лишь в рамках системы компоновки данных (СКД).

Главная задача отчета - обеспечить удобное получение данных журнала регистрации, их просмотр и анализ.

Основной функционал отчета:

* Поддержка получения данных журнала регистрации текущей информационной базы и из ранее сохраненных файлов.
* Возможность установить стандартные фильтры по журналу регистрации и любые гибки настройки с помощью настроек СКД
* Возможность сохранять варианты отчетов
* Реализована поддержка пользовательских настроек СКД
* Реализована двухэтапная работа с отчетом:
    * настройка фильтров и получение данных из журнала регистрации,
    * работа с полученными данными через настройки СКД, многократное использование ранее полученных данных
* Гибкие настройки кэширование данных отчета
* Замер времени выполнения отчета

Отчет не решает проблемы производительности, по крайней мере в текущей версии. Интересен этот момент? Дайте знать в комментариях. Кто знает, возможно появление версии отчета для работы с журналом регистрации из SQL-баз или даже ElasticSearch.

## Требования

Для корректной работы отчета требуется платформа 1С:Предприятие не ниже версии 8.3.6. Последняя версия отчета поддерживает только работу в управляемом приложении (обычные формы не поддерживаются).

Также журнал регистрации должен быть включен для информационной базы в любом формате (не важно старый или новый формат) и сбором необходимой для Вас информацией (только ошибки, предупреждения или другой вариант, см. настройки через конфигуратор).

Отчет поддерживает функционал БСП в части внешних отчетов и обработок, а также может использоваться для рассылки информации через подсистему "Рассылка отчетов".

## Настройки отчета

Рассмотрим основные настройки отчета и некоторые другие возможности.

### Настройки фильтров, состава полей и максимального количества записей

Отчет поддерживает настройку всех фильтров журнала регистрации. На первом этапе необходимо установить все необходимые фильтры, которые поддерживаются стандартными возможностями платформы.

Форма настроек фильтров схожа со стандартным функционалом платформы 1С.

![1. Пример работы с отчетом](./media/2.%20%D0%A4%D0%BE%D1%80%D0%BC%D0%B0%20%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B5%D0%BA%20%D1%84%D0%B8%D0%BB%D1%8C%D1%82%D1%80%D0%BE%D0%B2.png)

После установки стандартных фильтров, состава получаемых колонок и источника получения данных (журнал текущей информационной базы или сохраненный ранее файл журнала), можно сформировать отчет или предварительно изменить настройки варианта отчета СКД.

Ниже пример сформированного отчета.

![3. Пример сформированного отчета](./media/3.%20%D0%9F%D1%80%D0%B8%D0%BC%D0%B5%D1%80%20%D1%81%D1%84%D0%BE%D1%80%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%BD%D0%BE%D0%B3%D0%BE%20%D0%BE%D1%82%D1%87%D0%B5%D1%82%D0%B0.png)

Есть несколько предопределенных вариантов отчета, предоставляющих провести анализ данных с разных сторон. Но можно не останавливаться на предложенных вариантах, а сделать свой. Для этого нужно перейти во подменю "Еще" и выбрать "Изменить вариант". Все как в стандартных отчетах.

Далее рассмотрим предопределенные варианты отчета и некоторые другие настройки.

### Другие настройки компоновщика

Никаких ограничений на использование настроек СКД нет. В полной мере можно использовать настройку структуры отчета, условное оформление, пользовательские поля и прочие настройки. Так, например, для подсчета количества событий в отчете было добавлено пользовательское поле выражения "Количество".

![4. Пользовательские поля для расширения функционала](./media/4.%20%D0%9F%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8C%D1%81%D0%BA%D0%B8%D0%B5%20%D0%BF%D0%BE%D0%BB%D1%8F%20%D0%B4%D0%BB%D1%8F%20%D1%80%D0%B0%D1%81%D1%88%D0%B8%D1%80%D0%B5%D0%BD%D0%B8%D1%8F%20%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D0%BE%D0%BD%D0%B0%D0%BB%D0%B0.png)

В отчете уже добавлены несколько пользовательских полей, которые могут пригодиться для создания собственных или добавления их в Ваш вариант отчета.

Таким образом, используя возможности СКД можно настроить отчет с достаточно сложной структурой вывода и разнообразными настройками, оформлением.

## Варианты отчета

В отчете уже созданы несколько вариантов отчета. На следующих скриншотах представлены некоторые из них.

### Использование метаданных

![5. Использование метаданных](./media/5.%20%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%20%D0%BC%D0%B5%D1%82%D0%B0%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85.png)

### Количество транзакций в секунду

![6. Количество транзакций в секунду](./media/6.%20%D0%9A%D0%BE%D0%BB%D0%B8%D1%87%D0%B5%D1%81%D1%82%D0%B2%D0%BE%20%D1%82%D1%80%D0%B0%D0%BD%D0%B7%D0%B0%D0%BA%D1%86%D0%B8%D0%B9%20%D0%B2%20%D1%81%D0%B5%D0%BA%D1%83%D0%BD%D0%B4%D1%83.png)

### Ошибки выполнения

![7. Ошибки выполнения](./media/7.%20%D0%9E%D1%88%D0%B8%D0%B1%D0%BA%D0%B8%20%D0%B2%D1%8B%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D1%8F.png)

### События журнала регистрации

![8. События журнала регистрации](./media/8.%20%D0%A1%D0%BE%D0%B1%D1%8B%D1%82%D0%B8%D1%8F%20%D0%B6%D1%83%D1%80%D0%BD%D0%B0%D0%BB%D0%B0%20%D1%80%D0%B5%D0%B3%D0%B8%D1%81%D1%82%D1%80%D0%B0%D1%86%D0%B8%D0%B8.png)

### Активность пользователей (общая)

![9. Активность пользователей (общая)](./media/9.%20%D0%90%D0%BA%D1%82%D0%B8%D0%B2%D0%BD%D0%BE%D1%81%D1%82%D1%8C%20%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D0%B5%D0%B9%20(%D0%BE%D0%B1%D1%89%D0%B0%D1%8F).png)

Это не полный список, который позволяет увидеть основные возможности отчета. Полный перечень предопределенных вариантов под следующим спойлером.

Список предопределенных вариантов:

* События журнала регистрации (по умолчанию)
* Активность пользователей (общая)
* Активность пользователей (по пользователям)
* Использование метаданных
* Количество транзакций в секунду
* Ошибки выполнения
* Ошибки доступа
* Работа с данными
* Сеансы пользователей

Не останавливайтесь на достигнутом! Постройте собственный вариант отчета!