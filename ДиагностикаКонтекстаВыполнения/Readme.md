# Диагностика контекста выполнения

Небольшая экспериментальная внешняя компонента для получения дополнительной информации о контексте выполнения.

Материалы по другим темам Вы можете найти на сайте [ypermitin.github.io](https://ypermitin.github.io/), а новости по проектам или новым материалам в [Telegram-канале](https://t.me/TinyDevVault).

## Состав

* [media](media) - медиафайлы для документации данной разработки.
* [src](src) - файлы исходного кода.

## Назначение

Компонента используется для диагностики специфичных ситуаций работы платформы 1С:Предприятие и часто носит больше экспериментальный характер. Разработка компоненты выполняется в открытом репозитории [YY.YellowDiagnostician](https://github.com/YPermitin/YY.YellowDiagnostician) под лицензией AGPL. По ссылке доступные исходные коды и собранная компонента для Windows x86/64 в разделе релизов.

![1. Основная форма обработки](./media/1.%20%D0%9E%D1%81%D0%BD%D0%BE%D0%B2%D0%BD%D0%B0%D1%8F%20%D1%84%D0%BE%D1%80%D0%BC%D0%B0.png)

Компонента была создана для диагностики некоторых сложных ситуаций в работе платформы 1С и разбору непонятного поведения.

Например, были разрешены следующие кейсы:

* Проверка доступности контекста домена на сервере и на клиенте. Была проблема с работой доменной аутентификацией в фоновых заданиях.
* Получение идентификатора рабочего процесса и потока в программном коде для детального анализа происходящего.
* Получение и проверка информации о пользователе операционной системы, от имени которого выполняются рабочие процессы. Необходимость была из-за специфичных настроек безопасности.
* Отслеживание потребления ресурсов отдельным фоновым заданиям.
* Может помочь в изучении работы асинхронности в платформе 1С, в т.ч. и той, которая появится в 8.3.18.

### Текущие возможности

Компонента имеет список методов для получения дополнительной информации. Некоторую из них можно получить в каком-либо виде средствами платформы 1С.

Компонента может использоваться как на клиенте, так и на сервере. Поддерживается только Windows x86/x64. Тестировалось на платформе 1С 8.3.12 и выше. Создана по технологии NativeAPI.

### API

DomainName (ИмяДомена) - получает имя домена, доступное в контексте приложения.

Возвращаемое значение:
* Строка. Имя домена.

UserName (ИмяПользователя) - получает имя пользователя, от имени которого запущено приложение.
Возвращаемое значение:
* Строка. Имя пользователя.

HostName (ИмяКомпьютера) - получает имя компьютера, на котором запущено приложение.
Возвращаемое значение:
* Строка. Имя компьютера.

ProcessName (ИмяПроцесса) - получает полное имя процесса (путь до исполняемого файла).
Возвращаемое значение:
* Строка. Полное имя к исполняемому файлу процесса.

ProcessId (ИдентификаторПроцесса) - получает числовой идентификатор текущего процесса.
Возвращаемое значение:
* Целое число. Числовой идентификатор процесса.

ThreadId (ИдентификаторПотока) - получает числовой идентификатор текущего потока.
Возвращаемое значение:
* Целое число. Числовой идентификатор потока.

Sleep (Ожидать) - ожидание потока указанное время.
Параметры:
* delay - Число (целое) - Количество секунд ожидания.
Возвращаемое значение:
* Отсутствует.

CurrentDate (ТекущаяДата) - текущая дата в контексте выполнения.
Возвращаемое значение:
* Дата и время. Текущая дата и время в контексте выполнения.

Простые примеры использования методов описаны в [репозитории на GitHub](https://github.com/YPermitin/YY.YellowDiagnostician).