# Технические проверки данных регистров бухгалтерии

Предназначен для проверки корректности данных в записях регистров бухгалтерии. Позволяет заблаговременно найти потенциальные проблемы, которые могут привести к некорректной работе итогов и расхождению данных в отчетах.

Материалы по другим темам Вы можете найти на сайте [ypermitin.github.io](https://ypermitin.github.io/), а новости по проектам или новым материалам в [Telegram-канале](https://t.me/TinyDevVault).

## Состав

* [media](media) - медиафайлы для документации данной разработки.
* [src](src) - файлы исходного кода.

## Назначение и возможности

Отчет "Технические проверки данных регистров бухгалтерии" предназначен для проверки корректности данных в записях регистров бухгалтерии. Позволяет заблаговременно найти потенциальные проблемы, которые могут привести к некорректной работе итогов и расхождению данных в отчетах.

![1. Пример работы с отчетом](./media/1.%20%D0%9F%D1%80%D0%B8%D0%BC%D0%B5%D1%80%20%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%8B%20%D1%81%20%D0%BE%D1%82%D1%87%D0%B5%D1%82%D0%BE%D0%BC.gif)

Отчет только анализирует данные и не содержит функционал для исправления данных. Для последнего рекомендую обратиться к другим инструментам на Инфостарт. Например, из публикации Должно быть NULL в регистре бухгалтерии Хозрасчетный от Дмитрия Малышева, в которой предложена обработка для исправления данных в типовом регистре бухгалтерии "Хозрасчетный". Во многих случаев процесс исправления должен выполняться в контексте информационной базы и сложившихся правил учета, поэтому будьте осторожны с применением универсальных алгоритмов исправлений.

Основными возможностями инструмента являются:

* Проверка данных проводок регистра:
    * Наличие "битых" ссылок как в полях регистра (измерения, реквизиты), так и в видах и значениях субконто.
    * Проверка небалансовых измерений (например, "Валюта Дт", "Валюта Кт", "Подразделение Дт", "Подразделение Кт" на корректность заполнения.
    * Проверка видов субконто в соответствии с настройками счета.
    * Проверка значений субконто в зависимости от состава видов субконто в счете и их типов.
* Гибкие настройки:
    * Выбрать проверяемый регистр бухгалтерии, если их несколько в конфигурации.
    * Указать произвольный период проверки.
    * Выбрать размер одной порции проверки данных. Получать все записи регистра на больших базах может быть не только не целесообразным, но и "убийственным" для системы. Эта настройка позволяет решить эту проблему.
    * Указать конкретные проверки
        * Проверять на "битые" ссылки
        * Проверить корректность значений небалансовых измерений
        * Проверить корректность видов субконто
        * Проверить корректность значений субконто
    * Указать произвольные фильтры по полям регистра бухгалтерии с помощью СКД (документ, счета).
    ![2. Отборы](./media/2.%20%D0%9E%D1%82%D0%B1%D0%BE%D1%80%D1%8B.png)
* Универсальность проверки:
    * Для любого регистра бухгалтерии в конфигурации
    * Не зависит от количества субконто
    * Не зависит от структуры регистра бухгалтерии
* Возможность интегрировать отчет в БСП для регламентного запуска проверки раз в месяц, каждый день или по другому произвольному расписанию.
![3. Демо 2](./media/3.%20%D0%94%D0%B5%D0%BC%D0%BE%202.gif)

## Требования

Минимальные требования для работы:

* Платформа 1С версии 8.3.5 и выше.
* Режим работы не имеет значения (клиент-серверный или файловая база. СУБД не имеет значения).
* Только управляемые формы. Для использования в обычном приложении используйте известные обходные пути.

Возможности отчета можно расширять, добавив в алгоритмы проверки собственные алгоритмы. Конечно, для этого нужно будет потратить время на разработку.

## Принцип работы

Принцип работы очень простой. За указанный период отчет получает записи регистра бухгалтерии порциями (см. настройку отчета) и с помощью кода встроенного языка выполняет различные проверки:

* Проверка "битых" ссылок - если в полях регистра, в т.ч. в видах и значениях субконто, есть ссылки на сущности, которые были удалены (то есть их не существует), то отчет покажет информацию об этой ситуации.
* Проверка небалансовых измерений. Например, "Валюта" в типовом регистре "Хозрасчетный" является небалансовым измерением, заполнение которого зависит от признаков учета счета. Если по счету включен валютный учет, то измерение должно быть заполнено, в противном случае должно быть установлено значение NULL. Если это правило не выполняется, то отчет уведомит об этом. Например, если вместо NULL была установлена пустая ссылка на валюту.
* Проверка видов субконто. Если для счета установлен состав вида субконто в проводке отличный от состава в самом счете - то это ошибка. Отчет уведомит об этом.
* Проверка значений субконто. Значение должно соответствовать допустимым типам вида субконто, а также иметь корректное пустое значение. Например, для составного типа это "НЕОПРЕДЕЛЕНО", а если вид субконто содержит только 1 ссылочный тип, то это должна быть пустая ссылка.

Это общее описание. В принципе, в некоторых случаях исправлять такие ошибки было бы поспешно, если такие данные содержатся в качестве "легаси" за последние 10 лет. Поэтому каждую ситуацию нужно рассматривать в контексте. Отчет лишь помогает в этом. 

## Хороших данных!

Причины появления технических ошибок в данных регистра бухгалтерии разнообразны:

* Ошибки в обмене данных (УРБД, КД2, КД3 или другие способы обмена). Всегда есть риск, что в режиме "Загрузка" придут данные, которые не отвечают настройкам счетов и видов субконто в базе приемнике. Нужны дополнительные проверки и ответственность при разработке.
* Некорректная обработка данных в алгоритмах после обновления на типовые релизы от фирмы "1С". Редко, но бывает.
* Изменение данных в проводках различными "универсальными" обработками.
* Свертка базы тоже является не редкой причиной "испорченных" данных, когда созданные бух. операции заполняют проводки с игнорированием правил учета.
* Также бывают случаи, что любимая всеми процедура "Тестирование и исправление" может привести к таким же проблемам.

Многие ошибки не "всплывают" сразу, а появляются лишь спустя пару месяцев, лет, а то и не появляются вообще до момента "ИКС". Это и странные записи в ОСВ и других отчетах по этому регистру, некорректные итоги и многое другое. Поэтому регулярные проверки данных регистров бухгалтерии открытого периода могут помочь избавиться от многих проблем в будущем.